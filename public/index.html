<html>
<head>
  <title>Set</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="viewport" content="width=device-width,  height=device-height, initial-scale=1, maximum-scale=1.0, user-scalable = no">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <link rel="stylesheet" href="index.css">
  <link rel="stylesheet" href="ai-assistant.css">
  <link rel="apple-touch-icon" sizes="57x57" href="set-icon.png"/>
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body class="dark autocomplete-on" draggable>
  <br><br>
  <svg style="height:0">
    <defs>
      <pattern id="green-stripe" x="0" y="0" width="1" height="8" patternUnits="userSpaceOnUse">
        <path class="stripe green" d="M0,0 l1,0 l0,3 l-1,0 Z"></path>
      </pattern>
      <pattern id="purple-stripe" x="0" y="0" width="1" height="8" patternUnits="userSpaceOnUse">
        <path class="stripe purple" d="M0,0 l1,0 l0,3 l-1,0 Z"></path>
      </pattern>
      <pattern id="red-stripe" x="0" y="0" width="1" height="8" patternUnits="userSpaceOnUse">
        <path class="stripe red" d="M0,0 l1,0 l0,3 l-1,0 Z"></path>
      </pattern>
    </defs>
  </svg>

  <div id="game">
    <div style="position:absolute; left:0%; top:17.5%; width: 100%; height:65%" id="table">
      <div style="position:relative;margin: 0 auto; width:100%;height:100%" id="display">
      </div>
      <div id="clock" class="clock huge" hidden>
      </div>
      <div id="restartBig" class="btn medium" hidden>
        Restart
      </div>
    </div>
    <div id="check-set" class="btn medium" style="position:absolute;width:100%;height:20%;bottom:0%;left:0%">
      <div id="check-set-text" style="position:absolute; top:30%;left:50%; transform: translate(-50%, -50%)">
        Check Set
      </div>
    </div>
    <div id="no-set" class="btn medium" style="position:absolute;min-width:30%;height:15%;top:0%;left:35%" hidden>
      <div style="position:absolute; top:30%;left:50%; transform: translate(-50%, -50%)">
        No Set
      </div>
    </div>
    <div id="done" class="btn large" style="position:absolute;min-width:30%;height:15%;top:0%;left:35%" hidden>
      <div style="position:absolute; top:30%;left:50%; transform: translate(-50%, -50%)">
        Done?
      </div>
    </div>
    <div id="settings" style="position:absolute;top:0%;left:0%">
      <div id="light-dark" class="btn small" ></div>
      <div id="autocomplete" class="btn small"></div>
    </div>
    <div id="restart" class="btn small" style="position:absolute;top:0%;right:0%">Restart</div>
    
    <!-- AI Assistant UI -->
    <div id="ai-assistant" class="ai-assistant-container">
      <div class="ai-assistant-header">
        <div class="ai-assistant-title">
          <i class="fas fa-robot ai-icon"></i> AI Assistant
        </div>
        <div class="ai-assistant-toggle" id="ai-assistant-toggle">
          <i class="fas fa-chevron-right"></i>
        </div>
      </div>
      <div class="ai-assistant-content" id="ai-assistant-content">
        <div class="ai-assistant-message">
          Hello! I'm your AI assistant for Set. I can help you learn the game, provide hints, and explain why cards form a set.
        </div>
      </div>
      <div class="ai-assistant-actions">
        <button class="ai-assistant-button" id="ai-hint-button">
          <i class="fas fa-lightbulb"></i> Hint
        </button>
        <button class="ai-assistant-button" id="ai-explain-button">
          <i class="fas fa-question-circle"></i> Explain Selection
        </button>
        <button class="ai-assistant-button" id="ai-strategy-button">
          <i class="fas fa-chess"></i> Strategy Tip
        </button>
      </div>
    </div>
  </div>

  <script src="header.js"></script>
  <script src="draw.js"></script>
  <script src="variants.js"></script>
  <script src="ai-assistant.js"></script>
  <script type="text/coffeescript" src="controller.coffee"></script>
  <script type="text/coffeescript" src="view.coffee"></script>
  <script type="text/coffeescript" src="model.coffee"></script>

  <script type="text/coffeescript">
    root = exports ? this
    $ ->

      root.Settings = {
        fastMode: true
        autocomplete: true
        theme: 'dark'
        gestureTimeout: 1000
        keyboardTimeout: 2000
        animationTime: 400
      }

      # Initialize AI Assistant
      root.aiAssistant = new AIAssistant()
      
      # Setup AI Assistant UI interactions
      $('#ai-assistant-toggle').on 'click', ->
        $('#ai-assistant').toggleClass('collapsed')
      
      $('#ai-hint-button').on 'click', ->
        $('#ai-assistant-content').append('<div class="ai-assistant-message"><div class="ai-assistant-loading"></div>Getting a hint...</div>')
        root.aiAssistant.getHint(root.Model.getCards(), root.Model.getSelected()).then (hint) ->
          $('.ai-assistant-loading').parent().html(hint)
      
      $('#ai-explain-button').on 'click', ->
        if root.Model.getSelected().length > 0
          $('#ai-assistant-content').append('<div class="ai-assistant-message"><div class="ai-assistant-loading"></div>Analyzing your selection...</div>')
          root.aiAssistant.explainSet(root.Model.getCards(), root.Model.getSelected()).then (explanation) ->
            $('.ai-assistant-loading').parent().html(explanation)
        else
          $('#ai-assistant-content').append('<div class="ai-assistant-message">Please select some cards first.</div>')
      
      $('#ai-strategy-button').on 'click', ->
        $('#ai-assistant-content').append('<div class="ai-assistant-message"><div class="ai-assistant-loading"></div>Thinking of a strategy tip...</div>')
        root.aiAssistant.getStrategyTip().then (tip) ->
          $('.ai-assistant-loading').parent().html(tip)

      root.variant = Variants.set
      root.Controller.start()
   </script>
   <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/coffee-script/1.1.2/coffee-script.min.js"></script>
</body>

</html>
